#!/bin/bash
########################################################################
#
# mkgallery
# Erstellt eine statische HTML Galerie
#
########################################################################

########################################################################
# Einstellungen
FOLDER="gallery"
RESPICTURE="1024x765"
RESTHUMBNAIL="200x200"
QUALITY="60"
HEADER=`cat gallery.header`
FOOTER="Generated by Emanuel Duss on `date "+%Y-%m-%d"` at `date "+%H:%M"`."

COLUMNS="4"

########################################################################
# Main
if [ ! -d "$FOLDER" ]
then
  mkdir "$FOLDER"
fi
if [ ! -f "$FOLDER/js/jquery-1.7.2.min.js" ]
then
  wget http://lokeshdhakar.com/projects/lightbox2/releases/lightbox2.51.zip
  unzip lightbox2.51.zip -d $FOLDER
  mv "$FOLDER/lightbox/*" "$FOLDER"
  rmdir "$FOLDER/lightbox"
  rm lightbox2.51.zip
fi

########################################################################
# HTML-Header
cat << EOI > $FOLDER/index.html
<!DOCTYPE html>
<html>
<head>
  <title>example.net</title>
  <meta name="generator" content="Bash-Script mkgallery" />
  <meta name="author" content="Emanuel Duss" />

  <style type="text/css"><!--
    body {
      font-family: Monospace;
    }

  .image {
    /* Runder Rahmen */
    background-color: gray;
    border: 7px solid white;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px;
    /* Schatten */
    -moz-box-shadow: 0px 0px 10px black;
    -webkit-box-shadow: 0px 0px 10px black;
    box-shadow: 0px 0px 10px black;

    margin: 20px;
  }

  .gallery {
    margin: 20px;
  }

   #footer {
     clear: both;
   }

   .picture {
     float: left;
     width: 250px;
     height: 250px;
     /* border: 2px solid black; */
     text-align: center;
     vertical-align: text-center;
     top: 125px;
   }

  hr {
    border: 1px solid gray;
  }

  --></style>

  <!-- Lightbox -->
  <script src="js/jquery-1.7.2.min.js"></script>
  <script src="js/lightbox.js"></script>
  <link href="css/lightbox.css" rel="stylesheet" />

</head>
<body>

<!--
  Was luegsch??? ;-)
-->

EOI

if [ -f "$HEADER" ]
then
  cat "$HEADER" >> $FOLDER/index.html
fi

########################################################################
# HTML-Content
COUNTER=0
echo "<div class=\"gallery\">" >> $FOLDER/index.html
for picture in *.[Jj][Pp][Gg]
do
  echo "Bild $COUNTER: $picture"
  # SIZE=`jhead $picture | awk -F: '/Resolution/{ gsub(/ /,"",$2); print $2 }'`

  # Resize Picture
  if [ ! -f "$FOLDER/$picture" ]
  then
    convert -resize $RESPICTURE -quality $QUALITY "$picture" "$FOLDER/$picture"
  fi

  # Create Thumbnail
  if [ ! -f "$FOLDER/t_$picture" ]
  then
    convert -resize $RESTHUMBNAIL -quality $QUALITY "$picture" "$FOLDER/t_$picture"
  fi

  # Create HTML
  echo "<div class=\"picture\"><a href=\"$picture\" rel=\"lightbox[gallery]\" title=\"$picture\"><img class="image" src=\"t_$picture\"></a></div>" >> $FOLDER/index.html

  COUNTER=`expr $COUNTER + 1`

done
echo "</div>" >> $FOLDER/index.html

########################################################################
# HTML-Footer
cat << EOI >> $FOLDER/index.html
<div id="footer">
<hr />
<address>$FOOTER</address>
</div>
</body>
</html>
<!-- EOF -->
EOI

# EOF
